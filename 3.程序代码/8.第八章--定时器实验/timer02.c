/*******************************************************************
*                                                        
* ******************************************************************
* 【主芯片】：STC89SC52/STC12C5A60S2
* 【主频率】: 11.0592MHz 
*                                                                                                                               	
* 【版  本】： V1.0                                          	
* 【作  者】： hugh                            	
* 【网  站】： www.rymcu.com                            	
* 【邮  箱】： hugh@rymcu.com                                         	
* 【店  铺】： rymcu.taobao.com                                          	
*                                                                 	
* 【版  权】All Rights Reserved 
* 【声  明】此程序仅用于学习与参考，引用请注明版权和作者信息！
         
* 【功  能】定时器实验（中断方式）
	设置定时长为1ms,在中断函数中累计50次即为50ms,并翻转一次小灯。
*******************************************************************/
#include<reg52.h>

#define FOSC 11059200 //单片机晶振频率
#define T_1ms (65536 - FOSC/12/1000)  //定时器初始值计算

sbit led0 = P1^0;
unsigned char count = 0;
void main()
{
	TMOD = 0x01;	 //定时器工作模式配置
	TL0  = T_1ms;	//装载初始值
	TH0  = T_1ms>>8;

	TR0  = 1;		 //启动定时器
	
	//中断相关，后续章节会讲解
	ET0  = 1;		 //允许定时器中断
	EA   = 1;		 //开总中断
	
	while(1)
	{	
			//dosomething();执行其他任务
	}
}

void timer0() interrupt 1 //定时器0中断函数的固定写法
{
	//TF0 = 0; 无需这条语句，进入该中断函数后，硬件会自动清零TF0
	
	TL0 = T_1ms;//重装初始值
	TH0 = T_1ms>>8;

	count++;
	if(count>=50)//	每一毫秒进入一次中断，达到50次则为50ms,翻转小灯。
	{
		count = 0;
		led0  = ~led0;
	}
}